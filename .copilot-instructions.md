# GitHub Copilot Instructions for Darbot Windows Agent

You are helping with the **Darbot Windows Agent**, a powerful Windows automation agent that bridges the gap between AI language models and the Windows operating system at the GUI layer.

## Project Overview

Darbot Windows Agent is a **Python 3.12+ automation framework** that enables any LLM to perform computer automation tasks on Windows without relying on traditional computer vision models. It uses Windows UI Automation APIs, Win32 APIs, and PyAutoGUI for reliable GUI control.

### Key Capabilities
- **Native Windows Integration**: Direct interaction with Windows GUI elements
- **Multi-LLM Support**: GitHub Copilot, OpenAI, Google Gemini, Groq, Ollama
- **GitHub CLI Integration**: Execute GitHub commands through the agent
- **Zero Vision Requirement**: Works without computer vision (vision optional)
- **Fast Performance**: 1.5-2.3 seconds per action latency
- **Extensible**: Built on LangChain with custom tool support

## Architecture & Tech Stack

### Core Technologies
- **Python 3.12+** with modern async/await patterns
- **LangChain** for LLM integration and agent orchestration
- **Windows UI Automation** (`uiautomation` library) for GUI element detection
- **PyAutoGUI** for mouse/keyboard automation
- **Win32 APIs** for system-level operations
- **Rich/Termcolor** for enhanced CLI output

### Project Structure
```
darbot_windows_agent/
├── agent/                    # Main agent implementation
│   ├── service.py           # Core agent service class
│   ├── tools/               # Automation tools
│   ├── prompt/              # System prompts
│   └── registry/            # Tool registry
├── desktop/                 # Windows desktop interaction
├── github/                  # GitHub integration & model selection
└── tree/                    # UI element tree utilities
```

### Available Tools (17 total)
- **GUI Tools**: click_tool, type_tool, scroll_tool, drag_tool, move_tool
- **System Tools**: launch_tool, shell_tool, clipboard_tool, switch_tool, resize_tool
- **Navigation**: shortcut_tool, key_tool, wait_tool, scrape_tool
- **Workflow**: done_tool, github_cli_tool

## Development Guidelines

### Code Style & Standards
- **Python 3.12+** type hints required
- **Ruff** for linting (line-length: 88)
- **Black** for code formatting
- **MyPy** for type checking
- **Pre-commit hooks** for automated quality checks

### Testing Approach
- **pytest** for unit testing
- **pytest-cov** for coverage reports
- Integration tests in `tests/` directory
- Manual validation required for GUI automation features

### Agent Tool Development
When creating new tools, follow this pattern:
```python
from langchain.tools import tool
from darbot_windows_agent.agent.tools.views import YourToolSchema

@tool('Your Tool Name', args_schema=YourToolSchema)
def your_tool(param: str, desktop: Desktop = None) -> str:
    '''Tool description for the agent'''
    # Tool implementation
    return "Tool result message"
```

### Model Integration
The project supports multiple LLM providers through `ModelSelector`:
- GitHub Copilot models (via GitHub CLI authentication)
- OpenAI models (requires `OPENAI_API_KEY`)
- Google Gemini (requires `GOOGLE_API_KEY`)
- Groq models (requires `GROQ_API_KEY`)
- Ollama (local models)

## Common Patterns & Best Practices

### Agent Initialization
```python
from darbot_windows_agent.agent import Agent
from langchain_google_genai import ChatGoogleGenerativeAI

# Standard initialization
llm = ChatGoogleGenerativeAI(model='gemini-2.0-flash')
agent = Agent(
    llm=llm,
    browser='chrome',  # 'edge', 'chrome', 'firefox'
    use_vision=False,  # Optional screenshot capability
    max_steps=100,     # Safety limit
    consecutive_failures=3
)
```

### Tool Usage in Agent Context
Tools are automatically injected with `desktop` parameter. The agent maintains state through:
- **AgentState**: Current execution state
- **AgentStep**: Step counter and limits
- **Desktop**: Windows UI interaction layer

### Error Handling
- Tools should return descriptive string messages
- Failed operations should not raise exceptions (return error messages)
- Use `consecutive_failures` limit to prevent infinite loops

## Windows-Specific Considerations

### UI Automation Requirements
- **English Windows locale** recommended for consistent UI trees
- **Administrator privileges** may be required for some operations
- **Target applications** should be running and visible
- **Screen resolution** affects coordinate-based operations

### Browser Support
The agent supports three browsers with full automation:
- **Microsoft Edge** (default, best compatibility)
- **Google Chrome** (recommended for web automation)
- **Firefox** (basic support)

### Common Windows APIs Used
- `uiautomation.WindowControl` for window management
- `pyautogui` for mouse/keyboard simulation
- `subprocess` for PowerShell command execution
- `psutil` for process management

## GitHub Integration Features

### GitHub CLI Tool
The agent can execute any GitHub CLI command:
```python
# Examples of GitHub CLI integration
agent.invoke("gh auth status")
agent.invoke("gh repo list --limit 10")
agent.invoke("gh pr create --title 'New Feature' --body 'Description'")
```

### Model Selection Interface
Interactive model selection similar to VSCode GitHub Copilot:
- Supports provider switching at runtime
- Automatic availability checking
- GitHub authentication integration

## Troubleshooting Guidelines

### Common Issues
1. **UI Element Not Found**: Elements may be off-screen (use scroll_tool)
2. **Permission Denied**: Some operations require administrator privileges
3. **Timing Issues**: Use wait_tool between operations for stability
4. **Model Authentication**: Ensure API keys are properly configured

### Debugging Tools
- Rich console output for detailed logging
- Screenshot capability (when `use_vision=True`)
- Step-by-step execution tracking
- Desktop element inspection utilities

## Contributing & Testing

### Before Submitting Changes
1. Run tests: `python -m pytest tests/`
2. Check linting: `ruff check .`
3. Format code: `black .`
4. Validate integration: `python test_integration.py`

### Extending the Agent
- Add tools in `darbot_windows_agent/agent/tools/`
- Update tool registry in `service.py`
- Create corresponding view schemas
- Add integration tests

## Platform Support
- **Primary**: Windows 10/11 (recommended)
- **Python**: 3.12+ required
- **Architecture**: x64 (primary), limited x86 support

When helping with this project, prioritize:
1. **Windows compatibility** and UI automation reliability
2. **Type safety** and modern Python practices
3. **Tool functionality** and agent workflow integration
4. **Performance** and minimal latency
5. **Extensibility** for custom automation scenarios

The agent is designed to make Windows automation accessible to any LLM, so focus on clear, reliable, and well-documented implementations.